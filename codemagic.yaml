workflows:
  main:
    name: iOS Build and Release
    max_build_duration: 60

    scripts:
      - name: Install dependencies
        script: |
          npm install -g yarn
          yarn install

      - name: Build iOS app
        script: |
          cd ios
          pod install
          cd ..
          npx react-native bundle --entry-file index.js --platform ios --dev false --bundle-output ios/main.jsbundle --assets-dest ios
          xcodebuild -workspace dpromApp.xcworkspace -scheme dpromApp -configuration Release -archivePath build/dpromApp.xcarchive archive -quiet || exit
          xcodebuild -exportArchive -archivePath "build/dpromApp.xcarchive" -exportOptionsPlist exportOptions.plist -exportPath build

    artifacts:
      - build/*.ipa

    publishing:
      email:
        recipients:
          - razercs93@gmail.com

    environment:
      flutter: stable